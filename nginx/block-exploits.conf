# Block binary/RDP exploit attempts
if ($request_method !~ ^(GET|HEAD|POST|PUT|DELETE|OPTIONS)$ ) {
    return 444;  # Close connection without response
}

# Block requests with binary content in URI
if ($request_uri ~ [\x00-\x08\x0B\x0C\x0E-\x1F]) {
    return 444;
}

# Block RDP cookie attempts
if ($http_cookie ~ "mstshash") {
    return 444;
}

# Block path traversal
if ($request_uri ~ "(\.\./|\.\.\\|%2e%2e)") {
    return 444;
}

# Block shell command injection
if ($request_uri ~* (wget|curl|bash|cmd|powershell|eval|exec|system)) {
    return 444;
}

# Block HNAP router exploits
location /HNAP1/ {
    return 444;
}

# Block debug tools
if ($arg_XDEBUG_SESSION_START) {
    return 444;
}

# Block actuator endpoints
location /actuator {
    return 444;
}

# Block CONNECT proxy attempts
if ($request_method = CONNECT) {
    return 444;
}

# Block CGI-bin and router exploit attempts
location ~* /(cgi-bin|cgi-mod|cgi-sys|luci|GponForm|setup\.cgi|admin\.cgi)/ {
    deny all;
    access_log /var/log/nginx/blocked_exploits.log;
    return 444;  # Drop connection immediately
}

# Block common router/IoT device paths
location ~* \.(cgi|pl|py|sh|bash)$ {
    deny all;
    access_log /var/log/nginx/blocked_exploits.log;
    return 444;
}
